Contents
1 Objective 9
2 Phase locked loop 10
2.1 Fundamentals of Phase locked loop . . . . . . . . . . . . . . . . . . . . . . 10
2.2 Mathematical analysis of PLL . . . . . . . . . . . . . . . . . . . . . . . . . 11
3 Phase locked loop using digitally controlled frequency modulator 13
3.1 Noise injector . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13
3.2 Phase detector . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14
3.3 Signal processor . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15
3.4 Digitally controlled frequency modulation. . . . . . . . . . . . . . . . . . . 15
3.4.1 Sine wave generator . . . . . . . . . . . . . . . . . . . . . . . . . . . 16
3.4.2 Quantizer . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16
3.4.3 Encoder . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17
3.4.4 Delta-Sigma digital-to-analogue modulator . . . . . . . . . . . . . . 17
3.4.5 Low pass ﬁlter. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17
3.4.6 Quadrature frequency converter . . . . . . . . . . . . . . . . . . . . 17
3.5 Analogue-to-digital converter . . . . . . . . . . . . . . . . . . . . . . . . . 18
3.6 Frequency divider . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
4 Delta-sigma modulators 20
4.1 Quantization noise . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22
4.2 First-order, Delta-sigma modulator . . . . . . . . . . . . . . . . . . . . . . 23
4.3 Sampled-Data model of a First-order ?? Modulator . . . . . . . . . . . . 24
4.4 Delta-Sigma Digital-to-Analogue Converter . . . . . . . . . . . . . . . . . . 26
4.5 Classiﬁcation of delta sigma modulators . . . . . . . . . . . . . . . . . . . 29
4.6 Higher order Sigma-Delta Modulators . . . . . . . . . . . . . . . . . . . . . 31
5 Active low pass ﬁlter 35
5.1 Design of Sallen-Key low-pass ﬁlter . . . . . . . . . . . . . . . . . . . . . . 35
5.2 Design of operational ampliﬁer . . . . . . . . . . . . . . . . . . . . . . . . . 40
6 Phase locked loop simulations 44
2CONTENTS CONTENTS
7 Evaluation 51
8 Conclusion and future work 52
References 53
List of Figures 54
3CONTENTS CONTENTS
4Executive summary
The modern digital communication systems especially the receivers, invariably employ a
high frequency clock essentially free of jitter. Hence extensive researches undertake the
study and design of new topologies for such systems.
A system is developed in this project whose output is digitally controlled by the action
of feedback. The system regularly compare the output with a reference clock, minimise
the noise and produce a stabilised clock. Phase locked loop is such a system, however it is
modiﬁed to suit the speciﬁcations.
A high resolution converter, delta sigma modulator is employed for digital control fre-
quency modulation which replace the conventional voltage controlled oscillator of phase
locked loop to achieve clock free of jitter. This is a contemporary topology which was
brought into the form after the preliminary investigation of noise sources in PLL being
that of noisy input reference, quantization error noise and the noise associated with ana-
logue components.
This project is in collaboration with Xintronix who specialize in high speed communi-
cations for data centre, telecommunications infrastructure and consumer applications.
5Low noise, High frequency synthesiser
Introduction
With the emergence of powerful digital signal processors for telecommunication, the use
of clock signals (of various frequencies) for synchronization and synthesis has become in-
evitable. The generation of a clock signal can be considered as the key element for any
telecommunication system. Thus the application of phase-locked loops (PLL) is signiﬁ-
cant. The idea of phase locked loop was ﬁrst conceived by H. D. Bellescize in 1932. Since
thenithasfoundmanyapplicationsincontrolsystem, measurementsandinstrumentation.
PLL’s are widely employed in radio, telecommunications, computers and other electronic
applications. They can be used to recover a signal from a noisy communication channel,
generate stable frequencies at a multiple of an input frequency (frequency synthesis), or
distribute clock timing pulses in digital logic designs. Since a single integrated circuit can
provideacompletephase-lockedloopbuildingblock,thetechniqueiswidelyusedinmodern
electronicdevices, withoutputfrequenciesfromafractionofaHertzuptomanygigahertz.
Although the concept of PLL was introduced in 1932, the realization was found to
be di?cult until the development of IC’s in 1980. Since then, the realization of PLL
using integrated circuit (IC) technology forimprovement in performance and for reliability
has become more important than ever. Hence the study and design of PLL is of prime
importance for any CMOS analogue designer.
University of Bristol 6Chapter 1
Objective
The project eventually aims to generate a high frequency signal (2.5GHz) essentially free
of jitter using a phase locked loop(PLL). The classic structure of PLL which is modiﬁed
to suit the speciﬁcations of the project(being to obtain a jitter free clock) is extensively
studies and implemented.
The fundamental approach undertaken in this system is to identify sources of jitter at
various points in the PLL and incorporate solutions to eliminate it. The sources of noise
and the associated preliminary solutions are discussed as follows.
The input reference signal which might have been impaired by jitter(inherent of clock
generation) is ﬁltered out using anti-aliasing ﬁlter before the signal is processed by delta-
sigma modulators. Since noise avoidance is the critical part, delta-sigma modulators is
incorporated which gracefully shape the noise out of the signal bandwidth to a much
higher frequency range . This high frequency noise can be subsequently ﬁltered out using
an analoguelow-pass ﬁlter. The ﬁltered signal nowis combined with quadrature frequency
converter which again is another source of noise. The feedback of the PLL compensates
for any noise introduced here.
Although, the PLL is a classic system, the use of sigma-delta modulators in the PLL
for noise avoidance is a contemporary topology. Apart from the classical components of
PLL, being the phase detector and low-pass ﬁlter, the system implemented here com-
prises of delta-sigma modulator and quadrature frequency converter. Cadence is adopted
to create the schematics for the block analogue low-pass ﬁlter(implemented at transistor
level) while all other components are implemented using VerilogA(hardware descriptive
language). The main added value is obtaining jitter free clock which is used for frequency
synthesizers whichﬁndapplicationsinradioreceivers, mobiletelephones, radio-telephones,
walkie-talkies, CB radios, satellite receivers, GPS systems.
9Low noise, High frequency synthesiser
Chapter 2
Phase locked loop
Thegenerationofahighfrequencysignalessentiallyrequiresafeedbacksystemtocompare
the output regularly with a reference signal. Phase locked loop is one such system. To get
an insight how a phase locked loop functions, a exhaustive literature review of the subject
has been undertaken and presented below.
2.1 Fundamentals of Phase locked loop
APLLisadevicewhichcausesonesignaltotrackanothersignal. Itkeepsanoutputsignal
synchronizing with a reference input signal in frequency with help of a feedback path. The
general block diagram of a PLL is as shown in ﬁgure 2.1.
The elements of the system are phase detector (PD), loop ﬁlter (LP) and voltage-
controlled oscillator (VCO). The VCO is an oscillator whose frequency is proportional to
an externally applied voltage. When the loop is locked on to an incoming periodic signal,
the VCO frequency is exactly equal to that of the incoming signal. The phase detector is a
non-linear device whose output contains the phase di?erence between the input reference
and the VCO signal.
This signal is utilized by the loop ﬁlter to produce a dc voltage corresponding to the
phase di?erence.
To further the explanation, if the frequency of the incoming signal shifts slightly, the
phase di?erence between the VCO signal and the incoming signal will begin to increase
with time. This will change the control voltage in such a way as to bring the VCO fre-
quency back to the same value as the incoming signal. Thus the loop can maintain lock
when the input signal frequency changes and the VCO input voltage is proportional to
the frequency of the incoming signal. The range of input signal frequencies over which the
loop can maintain lock is called ”lockrange”. [3]
An important aspect of the PLL performance is the capture process, by which the loop
University of Bristol 10Low noise, High frequency synthesiser
Figure 2.1: General PLL block diagram
goes from the unlocked, free-running condition to that of being locked on a signal. In the
locked condition, the VCO runs at the frequency corresponding to zero applied dc voltage
atitscontrolinput. Thisfrequencyiscalledthecenterfrequencyoffree-runningfrequency.
The PLL is a highly non-linear system due to two of its indispensable non-linear com-
ponents i.e. the phase detector and the voltage-controlled oscillator which translate the
problem from signal response to phase response and back again.
2.2 Mathematical analysis of PLL
Consider vin(t) and vout(t) to be the input reference and output of oscillator signals with
? and ? as their angular frequencies and ? and ? as their phase constants. The vin(t)
i o i o
and vout(t) can be written as,
vin(t) =ACos(?t+?t) (2.1)
i i
vout(t)=BCos(? t+? t) (2.2)
o o
where A and B are constants.
The PD acts as a signal multiplier and hence the output of the PD can be written as,
v (t) =K Cos[(? ?? )t+? ?? ]+Cos[(? +? )t+? +? ] (2.3)
pd pd i o i o i o i o
where K is the PD constant.
pd
1
Using, CosuCosv = [Cos(u?v)+Cos(u+v)]
2
University of Bristol 11Low noise, High frequency synthesiser
The higher frequency component (? +? ) is eliminated by the low pass ﬁlter(LPF)
i o
and hence its output can be given as,
v (t) =K Cos[(? ?? )t+? ?? ] (2.4)
lpf pd i o i o
After su?cient period of time, allowing the VCO output to synchronize with the input
signal, it can be shown that,
vout(t)=Bsin(?t+? ) (2.5)
i 0
Comparing 2.2 and 2.5,
? = (? ?? )t+? (2.6)
o i o o
and LPF output signal v (t) becomes,
c
v (t) =K cos(? ?? (2.7)
c d i o)
The VCO is a frequency-modulated oscillator, whose instantaneous angular frequency
is a linear function of the controlled signal v (t), around the central angular frequency
c
d
w = (? t+? ) =? =K V t (2.8)
inst o 0 o v c
dt
Taking derivative of Eq. 2.6,
d?
o
=K v (t) (2.9)
c c
dt
? ?? =K K cos(? ?? ) (2.10)
i o d v i o
It can be derived that,
? ??
i o
?1
? =? ?cos (2.11)
o i
K K
d v
Yielding,
? ??
i o
v (t) = (2.12)
c
K
v
Equation 2.12 clearly shows that it is the dc signalv , that changes the VCO frequency
c
fromitscentralvalue? , totheinput signalangularfrequency? [4].Thisistheunderlying
o i
concept of PLL.
University of Bristol 12Chapter 3
Phase locked loop using digitally
controlled frequency modulator
The prototypal system of PLL is prone to signal noise and interference which becomes a
major impediment where high frequency signals are involved. Another main drawback of
the conventional PLL is the use of considerable amount of analogue circuitry. The ana-
logue complexities signiﬁcantly slow down the operation of PLL mainly due to the VCO
and hence a faster oscillating VCO would be expensive. Due to the PLL being sensitive to
noise, the VCO and the loop ﬁlter would have to be isolated from the high speed digital
circuitry adding to increased complexity of design.
In order to achieve a robust signal, the VCO of the classic PLL is been replaced by a
digitally controlled frequency modulator(DCFM) and a frequency converter. The DCFM
employs a digital-to-analogue delta-sigma modulator to generate a control signal and the
frequency converter to translate the input reference signal(of lower frequency) to a higher
frequency signal basically performs frequency multiplication. The ﬁgure 3.1 shows the
topology of the modiﬁed PLL to achieve a jitter free high frequency clock.
It is required to detect and suppress side-band frequencies of the input reference signal
and thereby achieve a ”clean” output from a ”noisy” input signal. As in a conventional
PLL, the output signal is regularly compared with the input reference signal, generate a
”correction” and employ it to steer the output signal towards the required frequency.
3.1 Noise injector
To simulate the ”real” environment in which a circuit operates, noise is generated in order
to verify the side-band suppression. For this, white Gaussian synchronous jitter is induced
to input reference signal. The verilogA code generates random numbers using a function
rdist ormal(seed,mean,stddev) which takes parameters a seed i.e. the start range, mean
n
andthestandarddeviationvalues. Themagnitudeofthenoisecanbescaledbymultiplying
13Low noise, High frequency synthesiser
Figure 3.1: Clock synthesis PLL
this factor by the desired amount.
3.2 Phase detector
The comparison of the input reference signal and the output of the PLL is achieved by
incorporating an XOR gate(ﬁgure 3.2). The phase detector detects any phase di?erences
in input reference and the feedback signal and then generates an error signal. The non-
linearity feature of the phase detector brings about the correction of phase error in the
loop.
x[nTs]
x[nTs]
u[nTs]
?err
u[nTs]
PD
output
?err
Figure 3.2: Phase detector using XOR logic
Although the XOR gate successfully determines the magnitude of correction required,
it fails to convey whether the feedback signal has to lead or lag the input reference signal.
This is the main disadvantage of XOR gate. Hence in order to determine the direction
University of Bristol 14Low noise, High frequency synthesiser
towardswhichthefeedbacksignalhastobesteered,subtractionofthetwosignalsiscarried
out which is dealt in later section.
3.3 Signal processor
A signal processor is employed in conjunction with the phase detector to determine the
phase error between the input reference and the feedback signal. It basically acts as a low
pass ﬁlter computing the average of the phase error over a period of time. The phase error
n
is sampled at a rate of 2 times the input reference signal where ”n” is the bit resolution
which is computed so as to determine the phase error w.r.t one cycle of reference signal.
Thisblockisanalogoustothecharge pumpofaconventional PLLdetermining the amount
by which the feedback signal has to be steered to lock onto the input reference signal.
The ”n” ischosen astoprocure a realizable clock frequency signal. The input reference
n
signal being 5MHz, which has to be sampled at a rate of 2 , i.e. 32 times the 5MHz is
160MHz. Hence the thesampling rateofthephase errorislargelyconstrained bythe clock
signal.
The signal processor is followed by a loop ﬁlter which is used to suppress the noise
and high-frequency signal components from the phase detector and provide adc-controlled
signal for the VCO. The phase error voltage is ﬁltered by the loop ﬁlter.
The type of the loop of the PLL is determined by the number of integrators within the
loop. TheVCOessentiallyconsistsofaintegratorandinclusionofloopﬁltercontributesto
another added integrator. Such a loop comprising two integrators is called as second-order
PLL[4]. The loop ﬁlter essentially determines the limit frequency which can be detected
by the loop for correction. Frequencies which are outside the range are not captured for
correction.
The loop ﬁlter implemented in this system is digital and realized using an adder and a
latch.
3.4 Digitally controlled frequency modulation
The block diagram of DCFM is as shown in ﬁgure 3.3. The digital control inputs from
the signal processor is utilised to generate a sinusoidal corresponding to the di?erence of
frequency between the input reference and the output signal. This sinusoidal generated
is quantized at a very high frequency and the converted to digital input which is utilised
by the delta-sigma modulator for pulse width modulation driven by a clock signal. The
pulse width modulated signalislowpass ﬁltered toderive ananalogue sinusoidal wave and
passed into a quadrature frequency converter where it is processed by an analogue mixer
University of Bristol 15Low noise, High frequency synthesiser
driven by an LC oscillator yielding the desired high frequency output signal. Hence this
block acts as VCO which has the feature that its oscillating frequency is controlled by the
input control bits.
The delta-sigma converter and its associated low-pass ﬁltering form the main part of
this speciﬁc project. The details of the blocks making up DCFM is explained in the next
coming sections.
Figure 3.3: Digitally controlled frequency modulator
3.4.1 Sine wave generator
The phase error coded as digital bits is utilized for the sinusoidal generation. Sine wave
generator (ﬁgure 3.4) generates sinusoidal by consulting and regenerating from a look-
up-table in memory. However for simulation purpose a sinusoidal is actually generated
whose frequency is determined by the output bits of signal processor. The minimum fre-
quency resolution is 10Hz and hence a 5 bit digital input will correspond to a maximum of
320Hz of di?erence between the input reference and the fed-back signal. In-phase and the
corresponding quadrature phase sinusoidal is generated for the inputs of the quadrature
frequency converter. The correction frequency i.e. whether the output sine wave has to
be added to or subtracted from the local oscillator frequency of frequency converter is
conveyed by swapping the in-phase and the quadrature phase signals.
3.4.2 Quantizer
The delta-sigma modulator essentially requires the input signal to be quantized at a much
higher rate than the Nyquist frequency which can be as high as 64, 128 times. To obtain
highresolutionbitpatternofsinusoidalahighfrequencysignalof2MHzisusedtoquantize
the sine generated.
University of Bristol 16Low noise, High frequency synthesiser
3.4.3 Encoder
The quantized output is now encoded onto a 10 bit digital number which will act as the
input to the delta-Sigma DAC.
3.4.4 Delta-Sigma digital-to-analogue modulator
The digital-to-analogue conversion is performed by the delta-sigma modulator required for
high resolution conversion and is of second-order, with a 1-bit quantizer and oversampling
ratio(M)128. Thedigitalcomponentsbeingthesubtracter,integrator,comparatorandthe
digital-to-digital converter are of 24 bits wide. It employs a clock signal whose frequency
is much higher than the Nyquist rate, generally 64 or 128 times the baseband signal.
It performs the DAC operation by utilising the input digital bits and generating a high
frequency pulse width modulated wave. It essentially shapes the quantization noise to
higher frequencies which can be subsequently ﬁltered out of the baseband signal yielding
a jitter free signal.
3.4.5 Low pass ﬁlter
The modulated wave is low-pass-ﬁltered to eliminate the quantization noise, shaped to
higher frequencies and also accomplishes analogue regeneration of sinusoidal wave. Sallen-
Key topology is incorporated to achieve low-pass ﬁltering which implements second-order
activeﬁlters. Thiscircuitactsaunitygainampliﬁerwhichhasaveryhighinputimpedance
and low output impedance.
3.4.6 Quadrature frequency converter
In several applications, frequency multiplication is employed where in an output signal is
generated whose frequency is harmonic of the input signal. In this speciﬁc PLL, apart
from frequency multiplying the input reference signal to 2.5 GHz, the frequency multiplier
has to also ”mix” the correction frequency with the input signal. Hence a quadrature
Figure 3.4: Sine wave generator using pulse width modulation
University of Bristol 17Low noise, High frequency synthesiser
frequency converter is employed to accomplish this functionality.
The quadrature frequency converter uses two mixers for frequency synthesis. One of
the frequency is the desired output frequency (2.5GHz in this speciﬁc system) and the
other is the error frequency to be either added or subtracted.
A mixer is a non-linear device, which performs a frequency conversion, either up or
down, of two input frequencies to one mixed output. They are a class of multipliers be-
cause they can multiply their two inputs. One of these inputs is a local oscillator (LO),
which usually has a ﬁxed frequency. The other input and output frequency names depend
onthewaythe conversion isperformed. Forup-conversion the second inputistheinterme-
diate frequency (IF)thatcan varyinagiven range. The mixed outputsignal isthen called
the radio frequency (RF). For down-conversion the two names are the other way round, as
then the second input has a higher frequency than the output, which is also usually in the
RF region.
Given the LO and IF inputs ofan up-converting multiplier aresinusoidal signals. Then
they can be described by,
v (t) =V .Cos(? t) (3.1)
LO LO 1
v (t) =V .Cos(? t) (3.2)
IF IF s
(3.3)
The resulting signal on the RF port is then,
v (t) =V .V Cos(? t+? ).Cos(? t+? ) (3.4)
RF LO IF 1 1 2 2
V .V
LO IF
v (t) = (Cos(? t?? t)+Cos(? t+? t) (3.5)
RF 1 2 1 2
2
The result term includes a di?erence frequency and a sum frequency. These terms are
responsible for either down-conversion or up-conversion.
3.5 Analogue-to-digital converter
The output derived from the frequency converter is analogous in nature and hence to
facilitate comparison with the input reference signal which is a digital clock, a analogue-
to-digital converter is incorporated.It compares the input voltage to a reference value and
outputs either a digital ”1” or ”0”.
3.6 Frequency divider
In case the desired output signal needs to be much higher than the input reference signal,
a frequency divider is added in the feedback path which divides the output frequency by
University of Bristol 18Low noise, High frequency synthesiser
the quantity(500 in this system) to be compared with that of the input reference signal.
The key design technique in the whole system of PLL is to keep the loop bandwidth as
low as possible to minimise noise interference.
The analogue low-pass ﬁlter is implemented using 180nm CMOS process(at transistor
level) in Cadence whereas the remaining blocks are implemented in VerilogA(hardware
descriptive language).
TheverilogAo?ersseveraladvantagesbeing, thesimulationofsystem-level designsand
complex mixed signal circuits can be accomplished with great ease and greatspeed. It also
o?ers easy debugging and reusable ability. [10]
University of Bristol 19Low noise, High frequency synthesiser
Chapter 4
Delta-sigma modulators
The powerful digital signal processors used for telecommunications require high-resolution
A/D or D/A converters. However, the quantizer introduces error which shows up as noise
in the resulting signal. Furthermore they are heavily constrained by higher frequency
sampling rates, required for improved performance (maximum sampling rate till then was
Nyquist rate). To overcome such drawbacks, the concept of oversampling was introduced
which reduced in-band quantization noise to achieve a high degree of resolution.
How is it achieved? The delta sigma modulator translates a N-bit PCM signal into a
1-bit fast data stream with few parallel bits. Fundamentally, ?? modulators re-quantize
high resolution input to a lower resolution. Because a 1-bit output is extremely easy to
implement in hardware and there are ways to make that one-bit output have the SNR of
an N-bit converter. This calls for oversampling the input data stream. The output 1-bit
data stream encodes the input value within its average
[12].
In the oversampling converters, the sampling frequency is kept much higher than the
Nyquist rate called as the oversampling ratio (M),typically higher by a factor between 8
to 512 and generate each output utilizing all preceding input values. This gives the ex-
tra dynamic range (due to extra bits of resolution). Furthermore, this same extra bit of
resolution can be obtained at lower sampling rates by spectrally shaping the quantization
noise over a larger frequency range through the use of negative feedback.
Deﬁnitions:
f = analog signal bandwidth
B
f = Nyquist frequency (two times f )
N B
f = sampling frequency
S
f f
S S
M = = = oversampling ratio
f 2f
N B
University of Bristol 20Low noise, High frequency synthesiser
Figure 4.1: Quantization error graph
University of Bristol 21Low noise, High frequency synthesiser
4.1 Quantization noise
A quantizer can be modelled as adding quantization error e(n) to input x(n) to generate
output y(n), i.e., y(n) = x(n) + e(n), where n refers to n-th sample. The output signal
is equal to the closest quantization level value. The quantization error is the di?erence
between the input and output values, which is bounded by±?/2,where? equals the dif-
ferencebetween twoadjacentquantizationlevels. Thequantizationlevelsandquantization
error are shown in ﬁgure 4.1.
The mean square value of the quantization error is,
Z ?
2
1 2 ?
2 2
e =S = e(x) dx = (4.1)
Q
rms
??
? 12
2
From equation 4.1, it can be seen that the quantization noise power is independent
of sampling frequency and hence our noise assumption and the subsequent analysis holds
good.
The spectral density of the sampled noise is,
s
√
2
E(f) =e =e 2? (4.2)
rms rms
f
S
where ? = 1/f
S
The in-band noise energy n is
0
Z
f
B
2 2
n = E (f)df (4.3)
0
0
2
e
2f
B
rms
2 2
n =e ( ) = (4.4)
0 rms
f M
S
2
e
rms
√
n = (4.5)
0
M
It can be shown that maximum SNR can be given by,
P
s
SNR = 10log( ) =6.02N +1.76?5.7+30log(M) (4.6)
max
P
e
Hence it can be observed that doubling the oversampling ratio M, decreases in-band
√
noise by a factor of only 2 which corresponds to -3dB. This property is exploited by
oversampling converters, since when an oversampled signal is quantized, the spectral com-
ponents of the quantization error are distributed in a larger frequency band[7].To obtain
much higher dynamic range, noise shaping through the use of feedback can be used [6].
University of Bristol 22Low noise, High frequency synthesiser
Since the total in-band noise power is reduced, the number of ”effective” bits is in-
creased from the actual bits.
While the most types of converters result in quantization noise of white spectrum,
delta-sigma converters shape the noise to higher frequencies which can be easily ﬁltered
out. This is the main advantage of ?? converters.
The oversampling converters requires considerable amount of digital circuitry in addi-
tion to some analogue stages. The accuracy requirements on the analogue components are
relaxed which considerably reduces the cost. The inclusion of digital circuitry tends to
make system faster and cheaper.
4.2 First-order, Delta-sigma modulator
It can be recalled that oversampling alone is not an e?cient way to modulate, rather a
more e?cient way is to adopt a noise-shaping sigma-delta modulator. Such a system in-
corporates a negative feedback. Furthermore, it is also essential to develop a system which
shouldactasaampliﬁerforthebasebandsignal(devoidofnoiseinthatrangeoffrequency)
and ignore the noise at higher frequencies where its gain is low[5]. The two linear inputs
being the signal and the noise can be deﬁned as,
Y(z) H(z)
Signal transfer function = STF = =
X(z) 1+H(z)
Y(z)
1
Noise transfer function = NTF = =
X(z) 1+H(z)
The ﬁlter which shapes the quantization error to higher frequency band is called NTF
whose transfer function is given by equation 4.2 which can be either a low-pass or band-
pass[7].
From above equations it can be observed that when H(z) goes to inﬁnity, NTF will go
to zero. To noise-shape the quantization noise in auseful manner, H(z) ischosen such that
itsmagnitudeislargefrom0tof andalsoSTFwilltendtounityinthefrequencybandof
B
interest. The NTF will tend to zero in the same band of frequency. Thus the quantization
noise is reduced over the frequency band of interest while signal remains una?ected[6].
The maximum level ofinput signal should be well within the feedback signal, otherwise
the large signal will saturate the input signal.
The H(z) for ﬁrst order noise-shaping modulator can be deﬁned as,
1
H(z) = (4.7)
z?1
A block diagram for such a transfer function is as shown in ﬁgure 4.2.
University of Bristol 23Low noise, High frequency synthesiser
Figure 4.2: Block diagram of First Order Sigma Delta modulator
4.3 Sampled-Data model of a First-order ?? Modu-
lator
Figure 4.3: Detailed block diagram of First-Order Delta Sigma modulator
The qualitative understanding of the delta-sigma operation can be explained referring
to the ﬁgure 4.3. Quantization noise is added to the input for the better comprehension.
The output of the delta-sigma modulator depends not only on the present value of the
input but also of the previous values and it produces a bit stream, the average level of
which represents the input signal level. The integrator (comprising of adelay element with
a feedback) acts as a comparator between the present values and the previous and outputs
a low if present value is lower than the previous value. The quantizer is a 1-bit quantizer
which bringsaboutthelinearitybetween thetwolevels [2]. The feedbackreducesthee?ect
of noise in the closed loop at low frequencies (ideally the signal bandwidth). To analyse
the functionality of the block the signal and noise transfer functions is derived.
From the ﬁgure 4.3, the relationship between output and the input is derived as,
University of Bristol 24Low noise, High frequency synthesiser
y[nT ] =q[nT ]+v[nT ]
s s s
v[nT ]=w[(n?1)T ]+v[(n?1)T ]
s s s
Therefore,
y[nT ]=q[nT ]+w[(n?1)T ]+v[(n?1)T ]
s s s s
=q[nT ]+x[(n?1)T ]?y[(n?1)T ]+v[(n?1)T ]
s s s s
But the ﬁrst equation can be written as,
y[(n?1)T ] =q[(n?1)T ]+v[(n?1)T ]
s s s
Substituting this relationship into the above gives,
y[nT ] =x[(n?1)T ]+q[nT ]?q[(n?1)T ] (4.8)
s s s s
From the equation 4.8, it can be observed that the output is the delayed version of
the input and a di?erentiated version of the quantization error. This structure does not
require a demodulation ﬁlter(since the input remains una?ected by the modulation pro-
cess), the ampliﬁcation of the in-band noise is prevented. Furthermore the di?erentiation
of error is further suppressed by the high sampling rate frequency. If the integrator has
high gain(compared to feedback path consisting of quantization noise), the in-band noise
isstronglyattenuatedtherebydeliveringthenoisetobeshapedouttohigherfrequencies[8].
Converting the equation 4.8 into Z domain,
?1 ?1
Y(z) =z X(z)+(1?z )Q(z) (4.9)
It is clear from equation 4.9 that the signal X(z) passes through unmodiﬁed while the
?1
quantization noise Q(z) is modiﬁed by the term 1?z .
The two terms can be now re-deﬁned as,
Y(z)
?1
Signaltransferfunction =STF = =z (4.10)
X(z)
Y(z)
?1
Noisetransferfunction =NTF = =1?z (4.11)
X(z)
(4.12)
University of Bristol 25Low noise, High frequency synthesiser
From the equations 4.11 and 4.12 it can be observed that, the NTF has now indeed
zeros at the origin resulting in high-pass transfer function. This high-pass characteristics
reduces the noise at low frequencies which is the key to obtain extra dynamic range within
the bandwidth of converter[1].
The feedbackforcestheaveragevalueofthequantized outputy(n)toequal theaverage
value of input x(n) so that the integrator’s input x(n)- y(n) equals zero (otherwise, the
inﬁnite dc gain will amplify the di?erence to inﬁnity).
Figure 4.4: Spectrum of "shaped" noise
The ﬁgure 4.4 shows how the noise is ”spectrally” shaped out of frequency band of
interest.
4.4 Delta-Sigma Digital-to-Analogue Converter
Beforeproceedingtothearchitectureofdelta-sigmaDAC,thesimpleprocessofdelta-sigma
modulation of 1st order is explained with the help of table 4.1,
The table 4.1 shows the simple operation of a sigma-delta 1st order modulator. As-
suming the input ranges from ”0” or ”16”, the input signal along with the output of
subtracter(shown in column 1) is subtracted by either lowest or highest number of the
range i.e. by either ”0” or ”16” according to the output of the comparator. The integrator
which comprises of an adder and a latch integrates the previous value with the present
input. The output of the comparator is either ”0” or ”15” when compared with mid-range
value i.e. less than or more than ”8”. This can be veriﬁed from column 3 of the table. The
pattern of the comparator output has an amazing property. Its average value is equal to
the value at the input of the modulator! i.e. ”13”. Hence by devising a circuit which can
compute the average value of the delta-sigma modulator output, the input signal can be
University of Bristol 26Low noise, High frequency synthesiser
Table 4.1: Simple operation of 1st order delta-sigma modulator
Input signal Integrator Comparator
13 - 0 = 13 0 + 13 = 13 1
13 - 16 = -3 13 + -3 = 10 1
13 - 16 = -3 10 + -3 = 7 0
13 - 0 = 13 7 + 13 = 20 1
13 - 16 = -3 20 + -3 = 17 1
13 - 16 = -3 17 + -3 = 14 1
13 - 16 = -3 14 + -3 = 11 1
13 - 16 = -3 11 + -3 = 8 1
13 - 16 = -3 8 + -3 = 5 0
13 - 0 = 13 5 + 13 = 18 1
13 - 16 = -3 18 + -3 = 15 1
13 - 16 = -3 15 + -3 = 12 1
13 - 16 = -3 12 + -3 = 9 1
13 - 16 = -3 9 + -3 = 6 0
13 - 0 = 13 6 + 13 = 19 1
13 - 16 = -3 19 + -3 = 16 1
reproduced without any undesired modiﬁcation.
It can be observed that although the input signal range from ”0” to ”16” the output
of the integrator stretches itself outside the range. Hence while designing the bus width of
the digital sigma-delta system it has to be ensured that the number of bits should accom-
modate the integrator output.
The delta-sigma modulator implemented in this project is a DAC and is as shown in
theﬁgure4.5. Itisaﬁrstorder loopcontaining anintegrator, 1bitcomparatorand digital-
to-digital converter.
TheDACimplementedcomprisesofasubtracter,digitalintegratorcomprisinganadder
and latch, a comparator and a digital-to-digital converter, all of which are 15 bits wide
i.e. ranging from 0 : 14. However, the input is restricted to 10 bits to accommodate the
integrator output. As observed from the table 4.1, the process of sigma-delta modulation
involves negative numbers also, hence a suitable signed number representation has to be
chosen. Simple sign-and-magnitude method is adopted for ease of implementation. The
? ?
15th bit is the sign bit where a 1 represents a negative number and a ’0’ positive number.
Also observed from the table 4.1 is that the output of the integrator can go beyond the
actual range of input due to the inherent property of integration, hence additional 4 bits
9
areprovided. Hencetheinputsignalwillberestrictedto10bitsrangingfrom0to1023(2 ).
University of Bristol 27Low noise, High frequency synthesiser
Figure 4.5: Block diagram of ﬁrst order sigma-delta modulator for DCFM
? ? ? ?
The subtracter either subtracts a 0 or 1023 from the input number. Two’s comple-
ment is employed to undertake the subtraction. The sign bit is updated accordingly.
The adder also employs two’s complement for addition of a negative number to a posi-
tivenumber orvice-versa, otherwise thetwo positivenumbers areaddedusing digitallogic.
The latch clocks the previous input to the adder to implement an integrator.
The comparison of the integrator output with the mid-range value is realized by ex-
tracting the MSB bit of the 10 bit numbers. The output is ’1’ if any bit above 8th bit is
high and sign bit is low. Its a ’0’ if sign bit is high or MSB bits are low.
Thedigital-to-digitalconverter performsbit-ﬁlloperationi.e. a’1’onMSBbitofPWM
signal appends all the 10 bits of input signal to ’11111111’ and same as for a ’0’.
ADACconverts thedigitallogictoVmaxand-Vmax, which inthiscaseis2.5Vto0V.
The simulation results are as shown in ﬁgure 4.6. The trace named ”sine” is the
8KHz sine wave representation, which utilises a clock signal of frequency 8.192 MHz for
modulation(in green trace) whose PWM output is shown in trace named ”PDMOut” and
which is low-pass ﬁltered(LPF2). The ﬁrst trace is the plot of Nyquist converter output
for the same given input signal to enable comparison.
Conventional converters sample the input signal at Nyquist rate. Essentially this sam-
pling frequency is 4 to 5 times the input signal. To enable comparison of the Nyquist
converters andthedelta-sigma modulators, botharefed ontheir inputsidentical frequency
signals and conversion carried out. Such a simulation results is as shown in the ﬁgure 4.7.
University of Bristol 28Low noise, High frequency synthesiser
Figure 4.6: First order delta-sigma DAC simulation results
Thebluetraceshowsthefrequencyplotofthedelta-sigmamodulatoranditcanbeseen
that the noise shaping is evident upto the sampling frequency. The frequency components
in the vicinity of the baseband signal(8 kHz) are attenuated by shaping out the noise
frequency components to higher frequencies. The red trace shows the frequency spectrum
plot of the Nyquist converter and it can be seen that visible frequency components present
in the vicinity of the baseband signal. The frequency spectrum of subsequent low-pass
ﬁltering of the PWM wave is as shown in the ﬁgure 4.8 and as pointed on the trace,
lower-left corner shows that frequency components above 10KH are ﬁltered out.
4.5 Classiﬁcation of delta sigma modulators
The performance of the ?? modulators can be improved by adopting various strategies
which can be listed as,
• Increasing order(L) of the integrator thus the order of the modulator.
• Increasing the oversampling ratio(M).
• Increasing the number of bits.
Various factors a?ect the choice of strategy employed. These depend on the nature of
signals handled whether low pass or band pass(ﬁgure 4.9)), number of bits and levels of
quantizer[7].
University of Bristol 29Low noise, High frequency synthesiser
Figure 4.7: Comparison results of delta-sigma and the Nyquist converters
Figure 4.8: Low-pass ﬁltering of the delta-sigma modulated wave
Figure 4.9: Low pass and band pass ?? modulators
University of Bristol 30Low noise, High frequency synthesiser
Since the input generated for ?? modulator is of frequency down to 0Hz, a low pass
??modulatorisemployed. A1-bitquantizer isusedsinceitiseasilyimplemented inhard-
ware and a second order integrator serves as compromise between accuracy and increased
complexity.
4.6 Higher order Sigma-Delta Modulators
Figure 4.10: Second order sigma delta modulator
The ﬁgure 4.10 shows the second order sigma delta modulator, so called due to its two
integrators connected in series. Its STF and NTF can be given as,
?1
STF =z (4.13)
?1 2
NTF =(1?z ) (4.14)
And the modulator output is given by,
?1 ?1 2
Y(z) =z X(z)+(1?z ) Q(z) (4.15)
In general, L-th order ?? modulator has the following form,
?K ?1 L
Y(z) =z X(z)+(1?z ) Q(z) (4.16)
K, depends on the architecture where K<L.
The noise transfer function can be written as,
?1
NTF (z) = (1?z ) (4.17)
Q
j?T
s
By replacing z by e it can be shown that,
MagnitudeofNTF =(2sin?fT ) (4.18)
s
The equation 4.18 is magnitude of noise transfer function.
University of Bristol 31Low noise, High frequency synthesiser
Figure 4.11: Noise power comparison of higher order modulators
The maximum SNR for second order sigma-delta modulator can be given by,
P
s
SNR =10log( )= 6.02N +1.76?12.9+50log(M) (4.19)
max
P
e
The graph 4.11 is the qualitative analysis of the equation 4.18. It can be observed
from equation 4.19 and from the ﬁgure 4.11 that doubling of M improves the SNR for a
second-order modulator by 15 dB[1].
As discussed in section 4.1, we have assumed the noise to be white and the power spec-
tral density of the modulator S (f) is,
E
S (f)
Q
2
S (f) =NTF (f) (4.20)
E Q
f
S
2
?
Integrating S (f) over the signal band to get the inband noise power using S = ,
E Q
12
Z
2
?f
B
1 ?
S = (2sin?FT )2L (4.21)
B S
f f 12
S B
Evaluating the above equation, in-band rms noise is given by,
  
q
L
? 1
√
n = S = e (4.22)
0 B rms
L+0.5
M
2L+1
where L = order of the modulator.
e
rms
Hence n ? .
0 L+0.5
M
University of Bristol 32Low noise, High frequency synthesiser
L+0.5
Doubling of M leads to a 2 decrease of in-band noise resulting in an extra L+0.5 bits
of resolution![1]
The second order delta-sigma digital-to-analoguecomprises two integratorsasshown in
ﬁgure 4.12. Due to double integration, the output of the last integrator can go far beyond
the input range and hence to accommodate such extensive calculations 24 bit wide bus is
adopted. A clock signal of frequency, same as that used in the ﬁrst order(8MHz) is utilised
to enable comparison between the modulators of two orders.
Figure 4.12: Comparison of ﬁrst and the second order delta-sigma modulator
Figure 4.13: Comparison of ﬁrst and the second order delta-sigma modulator
Theﬁgure4.13showsthecomparisonbetweentheﬁrstandthesecondorderdelta-sigma
modulators. The red and the blue trace shows the frequency components of the second
and the ﬁrst order delta-sigma modulators. It can be seen that second order modulator
shapeslargernumberofnoisefrequenciestohigherfrequenciesforthesameclockfrequency.
The comparison results of di?erent oversampling ratios is as shown in the ﬁgure 4.14.
Thebluetrace(frequency spectrum ofPWMwave using Mvalueas8MHz)suppresses side-
University of Bristol 33Low noise, High frequency synthesiser
Figure 4.14: Comparison of modulators employing 1MHz and 8MHz clock as oversampling
ratio
band frequencies better than that of modulator using 1MHz as oversampling ration(red
trace).
Henceitcanbeconcludedthat??modulatorsconstitutesbesttechniqueforconversion
and also o?ers several features from which the performance can be further improved.
University of Bristol 34Low noise, High frequency synthesiser
Chapter 5
Active low pass ﬁlter
The pulse width modulated signal derived from the delta-sigma modulator is converted to
a sinusoidal using an analogue low pass ﬁlter. Furthermore the low-pass ﬁlter also remove
the undesired higher frequencies for which an active low-pass ﬁlter is used. The advantage
of using an active low pass ﬁlter with a unity bu?er operational ampliﬁer is that the op-
amps has high input impedance preventing excessive loading on the ﬁlters output while
its low output impedance prevents the ﬁlters cut-o? frequency point from being a?ected
by changes in the impedance of the load. More speciﬁcally a second-order ﬁlter is used to
attain a steeper stop-band roll-o? as compared to ﬁrst order ﬁlters.
A Sallen-Key topology is incorporated which implements second-order active ﬁlter.
This circuit acts a unity gain ampliﬁer which has a very high input impedance and low
output impedance.
The key advantage of this circuit which is especially relevant to obtaining low-noise
signal is that it has sharp ”knee” transition. This topology implements a 2-pole ﬁlter and
this inherent property aids to reduce the interfering signal without degrading the desired
signal. Further, cascading several stages can o?er a steep attenuation curve with a very
sharp knee. Also, since it is a unity gain ampliﬁer the power consumption is drastically
reduced due to absence of resistors in the feedback path.
5.1 Design of Sallen-Key low-pass ﬁlter
The transfer function of the circuit in the ﬁgure 5.1 is given by,
vout Z Z
3 4
= (5.1)
vin Z Z +Z (Z +Z )+Z Z
1 2 3 1 2 3 4
Equation 5.1 is the form of second order ﬁlter.
University of Bristol 35Low noise, High frequency synthesiser
Figure 5.1: Sallen-key generic circuit
Figure 5.2: Sallen-Key topology
University of Bristol 36Low noise, High frequency synthesiser
The Sallen-Key low pass ﬁlter has components R1, R2, C1 and C2 conﬁgured as shown
in the ﬁgure 5.2.
The operation can be described qualitatively as follows:
At low frequencies,C1 and C2 act as open circuits and the signal is simply bu?ered to the
output.
At high frequencies, C1 and C2 act as short circuits and the signal is shunted to ground
at the ampliﬁers input, the ampliﬁer ampliﬁes this input to its output, and the signal does
not appear at Vo. Near the cut-o? frequency, where the impedance of C1 and C2 is on the
same order as R1 and R2, positive feedback through C2 provides Q enhancement of the
signal.
This circuit is a non-inverting op-amp, the ratio of output and input voltages always
remaining a constant K which is,
By applying Kircho?’s law it can shown that the transfer function in terms of circuit
elements is given by,
V 1/R R C C
2 1 2 1 2
= (5.2)
2
V s +(1/R C +1/R C +1/R C ?K/R C )s+1/R R C C
1 1 1 2 1 2 2 2 2 1 2 1 2
Equation 5.2 can be compared to the second order transfer function of a low-pass ﬁlter
given by,
2
?
0
H(s)= (5.3)
? 2
2
s +s( )+?
0
Q
Comparing equation 5.2 and 5.3, equations for ? and ”Q” can be derived as,
0
1 ? R R C C
0 1 2 1 2
2
? = Q = (5.4)
0
R R C C (R +R )C
1 2 1 2 1 2 2
Given ? , setting R = R = R and choosing a convenient C ,C can be calculated [9].
0 1 2 1 2
For a cut-o? frequency 15kHz, the value of design parameters derived are R = R =
1 2
50K ohms and C = C = 213 pF yielding the schematic as shown in the ﬁgure 5.3.
1 2
Low-pass ﬁltering of 8kHz is achieved and is shown in the ﬁgure 5.4 after undertaking
AC analysis.
The transient response of the two analogue low-pass ﬁlters connected in series is shown
in the ﬁgure 5.5. The blue trace is the output of ﬁrst low-pass ﬁlter which converts the
PWM wave to a sinusoidal and the second low-pass pass ﬁlter(output of which is shown
in purple trace) smooths the output of the ﬁrst low-pass ﬁlter. Owing to the RC circuit in
University of Bristol 37Low noise, High frequency synthesiser
Figure 5.3: Sallan-Key topology
Figure 5.4: AC simulations of Sallen-Key topology
University of Bristol 38Low noise, High frequency synthesiser
Figure 5.5: Transient response of the analogue low-pass ﬁlter
Figure5.6: Frequency spectrum ofthedelta sigmamodulatedsignaland thelow-passﬁlter
University of Bristol 39Low noise, High frequency synthesiser
the path a delay is observed between the input and the output sine waves.
The ﬁgure 5.6 shows the frequency spectrum of the delta sigma modulated signal and
the two low-pass ﬁlters connected in series(blue trace - PWM wave, red - output of ﬁrst
LPF, green - output of second LPF).
5.2 Design of operational ampliﬁer
The ampliﬁer used in the low-pass ﬁlter is a two-stage ampliﬁer with di?erential inputs as
shown in theﬁgure5.7with acapacitorC connected inthefeedback path. Thenoiseinan
c
operational ampliﬁer is dominated by that of input stage. Hence this operational ampliﬁer
speciﬁcally realizes PFET di?erential inputs, since PFET devices o?er less noise and have
better component matching by placing the input pair in a ﬂoating n-well[11]. The Miller
capacitor (capacitor connected between the output of the second stage to the input of ﬁrst
stage)facilitatesthe”splitting”ofthepolessothatoneofthetwopolesbecomesdominant
and thereby achieve stability. Figure 5.7 also shows the device dimensions calculated for a
given gain bandwidth given by the equation 5.5.
Figure 5.7: Schematic of OpAmp with device dimensions
g
mI
GB = (5.5)
C
c
where g = Transconductance of the ﬁrst stage and C = Miller capacitance.
mI c
For a C ≥ 0.22C where C 10pF, the device sizes of the di?erential input pair is
c L L
determined.
University of Bristol 40Low noise, High frequency synthesiser
The dimensions ofthecurrent mirror loaddevices ischosen tobeW/L= 1, iftheCMR
is not a concern.
0
For a given 60 phase margin, the second stage transconductance is determined using
the equation 5.6,
CII
g =2.2g ( ) (5.6)
mII mI
C
c
Thedimensionsofthesecondstagedevicesarecalculatedutilisingthetransconductance
of the ﬁrst and the second stages as given by the equation 5.7,
g
mI
S =S (5.7)
II currentmirrormosfet
g
mII
The DC analysis is carried out with worst case varying di?erential inputs as shown in
ﬁgure 5.8. As seen the o?set voltage is zero and the ampliﬁer behaves expectedly for the
maximum voltage swing on the inputs.
Figure 5.8: DC analysis with di?erential inputs and output
For frequency varying from 10Hz to 1GHz, the opamp has an AC gain of 34dB upto
400KHz (ﬁgure 5.9).
The opamp in this case is used as a closed system hence stability is of main concern.
Therefore a maximum negative feedback is applied while designing the opamp i.e. output
of the second stage short circuited to the inverting input of the ﬁrst stage. The stability
of the operational ampliﬁer is determined by stability analysis and as shown in ﬁgure 5.10
and whose gain and the phase margin are as shown in the ﬁgure 5.11.
University of Bristol 41Low noise, High frequency synthesiser
Figure 5.9: AC analysis of OpAmp
Figure 5.10: Stability analysis of OpAmp
University of Bristol 42Low noise, High frequency synthesiser
Figure 5.11: Stability summary with phase and gain margin
University of Bristol 43Chapter 6
Phase locked loop simulations
As discussed earlier, the two mixers in the quadrature frequency converter require a same
frequency signal but di?er in their phase by a quadrature. The other input are also in
quadrature but who derive the signal from a local oscillator. This topology of the mixer
gives rise to the possibility of two architecture of DCFM controlled PLL which are dis-
cussed below,
• Access the sine generated at two locations to generate quadrature PCM streams and
use two sigma-delta modulators to generate two quadrature PWM outputs.
• Access the sine generated at one location and generate a PCM input to a single sigma-
delta modulator which generates a single PWM stream. Split the stream into two
?
and delay one by the number of delta-sigma output samples equivalent to the at
4
the current frequency.
In the latter of the two architectures discussed, the split has to be done for the phase
error analogue sinusoid which has a very low bandwidth feeding the mixer. The splitting
and subsequent generating of quadrature signal would require a capacitor of very high or-
der(in nF)andlimitsthedrive ofthemixer. Furthermore, thiswould alsoneed feedback to
avoid undesired frequency components to overcome PVT variations and mismatch. How-
ever, splitting the sinusoid in digital domain before being given as input to delta sigma
modulator would require few latches and no feedback. Hence it is preferred to operate two
sigma-delta modulators in quadrature and mix using the quadrature frequency converter.
Incorporating this architecture, the phase locked loop using digitally controlled fre-
quency modulation block diagram is as shown in the ﬁgure 6.1. The output of the PLL is
locked to a input reference signal of 5MHz impaired with jitter. The loop ﬁlter utilises a
clock multiple of of the input reference signal and speciﬁcally in this system it is 32 times
5MHz.
44Figure 6.1: Phase locked loop using digitally controlled frequency modulationLow noise, High frequency synthesiser
The frequency spectrum of the ideal reference signal and that of the induced with jitter
is as shown in the ﬁgure 6.2. It can be seen that signiﬁcant undesired energy is present in
side-band frequencies and which has to removed by the action of PLL to achieve a stable
clock.
Figure 6.2: Frequency spectrum of white noise
The ﬁgure 6.3 shows the phase error detection using XOR gate and it can be observed
thatitfailstoconvey thedirectioninwhich theVCOhastosteeritself tocorrectthephase
error. However, phase error detection using subtraction outputs three levels as shown in
the ﬁgure 6.4. A positive value corresponds to a negative correction and vice versa. A zero
level corresponds to a nil correction. It can also be observed that this three levels of phase
error is responsible for the non-linearity.
Figure 6.3: Output of the phase detector using XOR gate
University of Bristol 46Low noise, High frequency synthesiser
Figure 6.4: Output of the phase detector using Subtraction
The blue trace in the ﬁgure 6.5 is the phase error count corresponding to one cycle of
the input signal for a unit time which generates corresponding sinusoidal for subsequent
modulation. The loop ﬁlter low-pass ﬁlters this output (green trace) to produce the av-
eraged sum. The corresponding frequency spectrum is shown in ﬁgure 6.6 and it can be
seen that the cut-o? frequency is 20kHz. Hence it can be concluded that the PLL will
detect and correct frequencies in the range ±20kHz of input reference signal. The main
advantageof DCFMPLL lies in the fact that it is able to track high frequency components
slowly without much constraints on components i.e. if the same functionality would had
to implemented using an analogue block. it would require huge amount of capacitances.
The digital counterpart needs few digital latches to accomplish this complex task.
Figure 6.5: Output of the signal processor
The ﬁgure 6.7 and ﬁgure 6.8 shows the output at various points in the PLL. The
corresponding labels in ﬁgure are self-explanatory.
University of Bristol 47Low noise, High frequency synthesiser
Figure 6.6: Frequency spectrum of signal processor
Figure 6.7: Simulation results of PLL 1-2
University of Bristol 48Low noise, High frequency synthesiser
Figure 6.8: Simulation results of PLL 2-2
Figure 6.9: Frequency spectrum of output signal locked to input reference signal of 5MHz
University of Bristol 49Low noise, High frequency synthesiser
Although the feedback signal is 2.5GHz, the ﬁgure 6.9 shows the frequency spectrum of
the input reference signal and the feedback signal which is divided by a factor correspond-
ing to the frequency multiplied to observe the noise suppression. It can be seen that the
reference signal (shown in red trace) contains frequency components of signiﬁcant energy
in the side-band. However, the output of the PLL(shown in green trace) has suppressed
side-band frequencies thereby ”cleaning” the input clock impaired by jitter.
Figure 6.10: Frequency spectrum of output signal
The ﬁgure 6.10 shows the 2.5GHz signal free of noise components. The presence of
immediate side-band frequencies depends on the resolution of the digitally coded signal
processor.
University of Bristol 50Low noise, High frequency synthesiser
Chapter 7
Evaluation
As isdesired, thenoise in the simulated PLL iscalculated using spectreRF toolofcadence.
However, owing to blocks coded in verilogA, the spectreRF could not be employed to cal-
culate because of the tool’s drawback to identify ”hidden” states in verilogA codes seen in
memory elements like ﬂip-ﬂops. Hence a frequency spectrum is used to verify the desired
functionality.
The active low-pass ﬁlter employ a very high values of capacitors of 212pF which is not
realizable easily. Hence either a higher gain of opAmp or higher cut-o? frequency could
compensate forthehighvaluesofcapacitances. And alsoabetterstability ofopAmpcould
ensure a steeper cut-o? frequency.
A second active low-pass ﬁlter was used to cut-o? the noise shaped high frequency
signals of the PWM wave. This second ﬁlter is redundant, however is included to meet the
high gain requirement of the operational ampliﬁer. Hence to design the ﬁrst opamp with
high gain would be a future e?ort.
University of Bristol 51Chapter 8
Conclusion and future work
To overcome the drawbacks of a conventional PLL, digitally controlled frequency modula-
tor is employed to ”lock” the output signal to input reference. This PLL successfully locks
the output to 2.5GHz derived from the input reference of 5MHz. The simulation results
show that the noise (inherent of the input reference signal) in the side-band frequencies is
suppressed. The loop ﬁlter suppresses the high frequency components to provide binary
coded DC voltage to the DCFM. The delta sigma modulators facilitate noise shaping and
thereby is mainly responsible for removal of quantization noise and subsequently obtain
the clock free from jitter. Since most of the circuitry of delta sigma modulators is digital,
the complexities of analogue components is refrained and also much cheaper and faster.
The clock used by the delta sigma modulators is of reasonable frequency and hence the
realisation of whole PLL in this topology is quite feasible. The noise caused by analogue
components of active low-pass ﬁlter is taken care by the feedback of the PLL. The only
high frequency signal required is the one of the input to quadrature frequency converter
and which can be obtained from a local oscillator. The generated output clock of the PLL
can be further utilised to synchronize the local oscillator signal(required for quadrature
frequency converter). The synchronisation is mutual which beneﬁt both the signals and
thereby achieve a stable clock.
The main advantage of the DCFM PLL is that it can track frequency components
slowly around the centre frequency which otherwise would require very large capacitances
to track by analogue blocks.
Higher order delta-sigma modulators could be incorporated for further noise shaping.
As discussed in the evaluation section, the second low-pass ﬁlter is redundant and which
can avoided by designing opamp of higher gain.
Most of the blocks of the PLL is coded in verilogA and the next step would be to
physically realize all the blocks in cadence. Such a system would o?er "real" jitter and
hence the capability of the PLL using DCFM would be completely exploited and it would
also facilitate calculation of noise using spectreRF.
52References
[1] P. E. Allen. Oversampling adcs - part i. Lecture 390,Lecture Organization.
[2] Zheng Chen. Vlsi implementation of a high-speed delta-sigma analog to digital con-
verter. Master’s thesis, Ohio University, 1997.
[3] PaulR.GrayandRobertG.Meyer. AnalysisandDesignofANALOG INTEGRATED
CIRCUITS. John Wiley and Sons Inc., 1993.
[4] Guan-Chyun Hsieh and JamesC. Hung. Phase-locked loop techniques-a survey. IEEE
TRANSACTIONS ON INDUSTRIAL ELECTRONICS, DECEMBER 1996.
[5] IEEE Ian Galton, Member. Spectral shaping of circuit errors in digital-to-analog
converters. IEEE TRANSACTIONS ON CIRCUITS AND SYSTEMS II: ANALOG
AND DIGITAL SIGNAL PROCESSING, VOL. 44, OCTOBER 1997.
[6] David A. Johns and Ken Martin. Analog Integrated Circuit Design. John Wiley and
Sons,Inc, 1997.
[7] IEEEJoséM.delaRosa,SeniorMember. Sigma-deltamodulators: Tutorialoverview,
design guide, and state-of-the-art survey. IEEE TRANSACTIONS ON CIRCUITS
AND SYSTEMS?I: REGULAR PAPERS, 2011.
[8] GaborC.TemesRichardSchreier. Understanding Delta-Sigma Data Converters. John
Wiley and Sons, 2004.
[9] M. E. Van Valkenburg. Analog Filter Design. CBS College Publishing, 1982.
[10] Ching-Hong Wang. A Top-Down Verilog-A Design on the Digital Phase-Locked Loop.
PhD thesis, Ohio University, 2002.
[11] Dr. Paul Warr. Analogue integrated circuit design. MS55 Advanced microelectronic
systems engineering AICD notes, University of Bristol, 2011-12.
[12] Randy Yates. One-bit delta sigma d/a conversion part i: Theory. [Available online].
53List of Figures
2.1 General PLL block diagram . . . . . . . . . . . . . . . . . . . . . . . . . . 11
3.1 Clock synthesis PLL . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14
3.2 Phase detector using XOR logic . . . . . . . . . . . . . . . . . . . . . . . . 14
3.3 Digitally controlled frequency modulator . . . . . . . . . . . . . . . . . . . 16
3.4 Sine wave generator using pulse density modulation . . . . . . . . . . . . . 17
4.1 Quantization error graph . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21
4.2 Block diagram of First Order Sigma Delta modulator . . . . . . . . . . . . 24
4.3 Detailed block diagram of First-Order Delta Sigma modulator . . . . . . . 24
4.4 Spectrum of "shaped" noise . . . . . . . . . . . . . . . . . . . . . . . . . . . 26
4.5 Block diagram of ﬁrst order sigma-delta modulator for DCFM . . . . . . . 28
4.6 First order delta-sigma DAC simulation results . . . . . . . . . . . . . . . . 29
4.7 Comparison results of delta-sigma and the Nyquist converters . . . . . . . 30
4.8 Low-pass ﬁltering of the delta-sigma modulated wave . . . . . . . . . . . . 30
4.9 Low pass and band pass ?? modulators . . . . . . . . . . . . . . . . . . . 30
4.10 Second order sigma delta modulator . . . . . . . . . . . . . . . . . . . . . . 31
4.11 Noise power comparison of higher order modulators . . . . . . . . . . . . . 32
4.12 Comparison of ﬁrst and the second order delta-sigma modulator . . . . . . 33
4.13 Comparison of ﬁrst and the second order delta-sigma modulator . . . . . . 33
4.14 Comparison of modulators employing 1MHz and 8MHz clock as oversam-
pling ratio . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34
5.1 Sallen-key generic circuit . . . . . . . . . . . . . . . . . . . . . . . . . . . . 36
5.2 Sallen-Key topology. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 36
5.3 Sallan-Key topology . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38
5.4 AC simulations of Sallen-Key topology . . . . . . . . . . . . . . . . . . . . 38
5.5 Transient response of the analogue low-pass ﬁlter . . . . . . . . . . . . . . 39
5.6 Frequency spectrum of the delta sigma modulated signal and the low-pass
ﬁlter . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 39
5.7 Schematic of OpAmp with device dimensions . . . . . . . . . . . . . . . . . 40
5.8 DC analysis with di?erential inputs and output . . . . . . . . . . . . . . . 41
5.9 AC analysis of OpAmp . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42
54Low noise, High frequency synthesiser
5.10 Stability analysis of OpAmp . . . . . . . . . . . . . . . . . . . . . . . . . 42
5.11 Stability summary with phase and gain margin . . . . . . . . . . . . . . . 43
6.1 Phase locked loop using digitally controlled frequency modulation . . . . . 45
6.2 Frequency spectrum of white noise . . . . . . . . . . . . . . . . . . . . . . 46
6.3 Output of the phase detector using XOR gate . . . . . . . . . . . . . . . . 46
6.4 Output of the phase detector using Subtraction . . . . . . . . . . . . . . . 47
6.5 Output of the signal processor . . . . . . . . . . . . . . . . . . . . . . . . . 47
6.6 Frequency spectrum of signal processor . . . . . . . . . . . . . . . . . . . . 48
6.7 Simulation results of PLL 1-2 . . . . . . . . . . . . . . . . . . . . . . . . . 48
6.8 Simulation results of PLL 2-2 . . . . . . . . . . . . . . . . . . . . . . . . . 49
6.9 Frequency spectrum of output signal locked to input reference signal of 5MHz 49
6.10 Frequency spectrum of output signal . . . . . . . . . . . . . . . . . . . . . 50
University of Bristol 55